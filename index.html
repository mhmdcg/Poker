<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Poker Game</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="welcome-card">
            <div class="logo">
                <h1>‚ô†Ô∏è ‚ô•Ô∏è Live Poker ‚ô£Ô∏è ‚ô¶Ô∏è</h1>
                <p class="subtitle">Texas Hold'em with Friends</p>
            </div>
            
            <div class="join-form">
                <h2>Join a Game</h2>
                <div class="input-group">
                    <label for="playerName">Your Name:</label>
                    <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
                </div>
                
                <div class="input-group">
                    <label for="roomId">Room Code:</label>
                    <input type="text" id="roomId" placeholder="Enter room code or leave empty for new game">
                </div>
                
                <div class="button-group">
                    <button id="joinBtn" class="btn btn-primary">Join Game</button>
                    <button id="createBtn" class="btn btn-secondary">Create New Game</button>
                </div>
                
                <div class="info">
                    <p>üéÆ Up to 9 players per table</p>
                    <p>üí∞ Start with 1000 chips</p>
                    <p>üåê Real-time multiplayer</p>
                </div>
            </div>
            
            <div class="instructions">
                <h3>How to Play:</h3>
                <ol>
                    <li>Enter your name</li>
                    <li>Share the room code with friends</li>
                    <li>Wait for players to join</li>
                    <li>Game starts automatically with 2+ players</li>
                </ol>
            </div>
        </div>
        
        <!-- Game Interface (Hidden initially) -->
        <div id="gameInterface" style="display: none;">
            <!-- Header -->
            <div class="game-header">
                <div class="room-info">
                    <h2>Room: <span id="roomCodeDisplay"></span></h2>
                    <p>Share this code with friends: <strong id="roomCodeShare"></strong></p>
                </div>
                <div class="game-status">
                    <span id="gameState">Waiting for players...</span>
                    <span id="round">-</span>
                </div>
                <button id="backToWelcome" class="btn btn-secondary">‚Üê Back to Welcome</button>
            </div>

            <!-- Poker Table -->
            <div class="poker-table">
                <!-- Community Cards -->
                <div class="community-cards">
                    <div class="pot-info">
                        <div class="pot">Pot: $<span id="potAmount">0</span></div>
                        <div class="current-bet">Current Bet: $<span id="currentBet">0</span></div>
                    </div>
                    <div class="cards" id="communityCards"></div>
                </div>

                <!-- Player Positions -->
                <div class="player-positions">
                    <!-- Position 1 (Bottom) -->
                    <div class="player-position bottom" id="pos-0">
                        <div class="player-info">
                            <div class="player-name">-</div>
                            <div class="player-chips">$0</div>
                            <div class="player-bet">$0</div>
                        </div>
                        <div class="player-cards" id="cards-0"></div>
                        <div class="player-status" id="status-0"></div>
                    </div>

                    <!-- Position 2 (Bottom Right) -->
                    <div class="player-position bottom-right" id="pos-1">
                        <div class="player-info">
                            <div class="player-name">-</div>
                            <div class="player-chips">$0</div>
                            <div class="player-bet">$0</div>
                        </div>
                        <div class="player-cards" id="cards-1"></div>
                        <div class="player-status" id="status-1"></div>
                    </div>

                    <!-- Position 3 (Right) -->
                    <div class="player-position right" id="pos-2">
                        <div class="player-info">
                            <div class="player-name">-</div>
                            <div class="player-chips">$0</div>
                            <div class="player-bet">$0</div>
                        </div>
                        <div class="player-cards" id="cards-2"></div>
                        <div class="player-status" id="status-2"></div>
                    </div>

                    <!-- Position 4 (Top Right) -->
                    <div class="player-position top-right" id="pos-3">
                        <div class="player-info">
                            <div class="player-name">-</div>
                            <div class="player-chips">$0</div>
                            <div class="player-bet">$0</div>
                        </div>
                        <div class="player-cards" id="cards-3"></div>
                        <div class="player-status" id="status-3"></div>
                    </div>

                    <!-- Position 5 (Top) -->
                    <div class="player-position top" id="pos-4">
                        <div class="player-info">
                            <div class="player-name">-</div>
                            <div class="player-chips">$0</div>
                            <div class="player-bet">$0</div>
                        </div>
                        <div class="player-cards" id="cards-4"></div>
                        <div class="player-status" id="status-4"></div>
                    </div>

                    <!-- Position 6 (Top Left) -->
                    <div class="player-position top-left" id="pos-5">
                        <div class="player-info">
                            <div class="player-name">-</div>
                            <div class="player-chips">$0</div>
                            <div class="player-bet">$0</div>
                        </div>
                        <div class="player-cards" id="cards-5"></div>
                        <div class="player-status" id="status-5"></div>
                    </div>

                    <!-- Position 7 (Left) -->
                    <div class="player-position left" id="pos-6">
                        <div class="player-info">
                            <div class="player-name">-</div>
                            <div class="player-chips">$0</div>
                            <div class="player-bet">$0</div>
                        </div>
                        <div class="player-cards" id="cards-6"></div>
                        <div class="player-status" id="status-6"></div>
                    </div>

                    <!-- Position 8 (Bottom Left) -->
                    <div class="player-position bottom-left" id="pos-7">
                        <div class="player-info">
                            <div class="player-name">-</div>
                            <div class="player-chips">$0</div>
                            <div class="player-bet">$0</div>
                        </div>
                        <div class="player-cards" id="cards-7"></div>
                        <div class="player-status" id="status-7"></div>
                    </div>
                </div>
            </div>

            <!-- Player Actions -->
            <div class="player-actions" id="playerActions">
                <div class="action-buttons">
                    <button class="btn btn-fold" id="foldBtn">Fold</button>
                    <button class="btn btn-call" id="callBtn">Call</button>
                    <button class="btn btn-raise" id="raiseBtn">Raise</button>
                    <button class="btn btn-allin" id="allInBtn">All In</button>
                </div>
                <div class="raise-controls" id="raiseControls">
                    <input type="range" id="raiseSlider" min="20" max="1000" value="20" step="10">
                    <span id="raiseAmount">$20</span>
                </div>
            </div>

            <!-- Chat -->
            <div class="chat-section">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Type a message...">
                    <button id="sendChat">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const socket = io(gameConfig.backendUrl);
        let currentPlayer = null;
        let gameState = null;
        let currentRoomId = null;
        
        // Show welcome page initially
        showWelcomePage();
        
        function showWelcomePage() {
            document.querySelector('.welcome-card').style.display = 'block';
            document.getElementById('gameInterface').style.display = 'none';
        }
        
        function showGameInterface() {
            document.querySelector('.welcome-card').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'block';
        }
        
        function createOrJoinGame(playerName, roomId = null) {
            if (!playerName) {
                alert('Please enter your name!');
                return;
            }
            
            currentPlayer = playerName;
            
            if (roomId) {
                // Join existing room
                currentRoomId = roomId;
                socket.emit('joinGame', { roomId, playerName });
            } else {
                // Create new room
                currentRoomId = Math.random().toString(36).substring(2, 8).toUpperCase();
                socket.emit('joinGame', { roomId: currentRoomId, playerName });
            }
        }
        
        document.getElementById('joinBtn').addEventListener('click', () => {
            const playerName = document.getElementById('playerName').value.trim();
            const roomId = document.getElementById('roomId').value.trim();
            createOrJoinGame(playerName, roomId);
        });
        
        document.getElementById('createBtn').addEventListener('click', () => {
            const playerName = document.getElementById('playerName').value.trim();
            createOrJoinGame(playerName);
        });
        
        // Enter key support
        document.getElementById('playerName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('joinBtn').click();
            }
        });
        
        document.getElementById('roomId').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('joinBtn').click();
            }
        });
        
        // Socket event handlers
        socket.on('joinedGame', (data) => {
            if (data.success) {
                gameState = data.gameState;
                showGameInterface();
                updateGameDisplay();
                addChatMessage('System', `${currentPlayer} joined the game!`);
                document.getElementById('roomCodeDisplay').textContent = currentRoomId;
                document.getElementById('roomCodeShare').textContent = currentRoomId;
            } else {
                alert(data.message);
            }
        });
        
        socket.on('gameUpdate', (newGameState) => {
            gameState = newGameState;
            updateGameDisplay();
        });
        
        socket.on('playerJoined', (data) => {
            addChatMessage('System', `${data.player} joined the game!`);
        });
        
        // Game action handlers
        document.getElementById('foldBtn').addEventListener('click', () => {
            socket.emit('playerAction', { action: 'fold' });
        });
        
        document.getElementById('callBtn').addEventListener('click', () => {
            socket.emit('playerAction', { action: 'call' });
        });
        
        document.getElementById('raiseBtn').addEventListener('click', () => {
            const amount = parseInt(document.getElementById('raiseSlider').value);
            socket.emit('playerAction', { action: 'raise', amount });
        });
        
        document.getElementById('allInBtn').addEventListener('click', () => {
            socket.emit('playerAction', { action: 'allIn' });
        });
        
        // Raise slider
        document.getElementById('raiseSlider').addEventListener('input', (e) => {
            document.getElementById('raiseAmount').textContent = `$${e.target.value}`;
        });
        
        // Chat
        document.getElementById('sendChat').addEventListener('click', sendChat);
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChat();
            }
        });
        
        function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (message) {
                addChatMessage(currentPlayer, message);
                input.value = '';
            }
        }
        
        function addChatMessage(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function updateGameDisplay() {
            if (!gameState) return;
            
            // Update game status
            document.getElementById('gameState').textContent = gameState.gameState === 'waiting' ? 'Waiting for players...' : 'Game in progress';
            document.getElementById('round').textContent = gameState.round.charAt(0).toUpperCase() + gameState.round.slice(1);
            
            // Update pot and current bet
            document.getElementById('potAmount').textContent = gameState.pot;
            document.getElementById('currentBet').textContent = gameState.currentBet;
            
            // Update community cards
            const communityCardsDiv = document.getElementById('communityCards');
            communityCardsDiv.innerHTML = '';
            gameState.communityCards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                cardDiv.textContent = card.toString();
                communityCardsDiv.appendChild(cardDiv);
            });
            
            // Update player positions
            for (let i = 0; i < 8; i++) {
                const player = gameState.players[i];
                const posDiv = document.getElementById(`pos-${i}`);
                const nameDiv = posDiv.querySelector('.player-name');
                const chipsDiv = posDiv.querySelector('.player-chips');
                const betDiv = posDiv.querySelector('.player-bet');
                const cardsDiv = document.getElementById(`cards-${i}`);
                const statusDiv = document.getElementById(`status-${i}`);
                
                if (player) {
                    nameDiv.textContent = player.name;
                    chipsDiv.textContent = `$${player.chips}`;
                    betDiv.textContent = player.currentBet > 0 ? `$${player.currentBet}` : '';
                    
                    // Show player's cards (only for current player)
                    if (player.name === currentPlayer) {
                        cardsDiv.innerHTML = '<div class="card">üÇ†</div><div class="card">üÇ†</div>';
                    } else {
                        cardsDiv.innerHTML = '<div class="card back">üÇ†</div><div class="card back">üÇ†</div>';
                    }
                    
                    // Status indicators
                    let status = '';
                    if (player.folded) status = 'FOLDED';
                    if (player.allIn) status = 'ALL IN';
                    if (player.isDealer) status = 'DEALER';
                    if (player.isCurrentPlayer) status = 'YOUR TURN';
                    statusDiv.textContent = status;
                    statusDiv.className = 'player-status ' + (status ? status.toLowerCase().replace(' ', '-') : '');
                    
                    posDiv.style.display = 'block';
                } else {
                    posDiv.style.display = 'none';
                }
            }
            
            // Update action buttons
            const currentPlayerData = gameState.players.find(p => p.name === currentPlayer);
            if (currentPlayerData && gameState.gameState === 'playing') {
                const isCurrentTurn = currentPlayerData.isCurrentPlayer;
                const canAct = !currentPlayerData.folded && !currentPlayerData.allIn;
                
                document.getElementById('playerActions').style.display = isCurrentTurn && canAct ? 'block' : 'none';
                
                if (isCurrentTurn && canAct) {
                    const callAmount = gameState.currentBet - currentPlayerData.currentBet;
                    document.getElementById('callBtn').textContent = callAmount > 0 ? `Call $${callAmount}` : 'Check';
                    
                    // Update raise slider
                    const raiseSlider = document.getElementById('raiseSlider');
                    raiseSlider.min = Math.max(gameState.bigBlind, gameState.currentBet + gameState.bigBlind);
                    raiseSlider.max = currentPlayerData.chips;
                    raiseSlider.value = raiseSlider.min;
                    document.getElementById('raiseAmount').textContent = `$${raiseSlider.value}`;
                }
            } else {
                document.getElementById('playerActions').style.display = 'none';
            }
        }
        
        // Back to welcome button
        document.getElementById('backToWelcome').addEventListener('click', () => {
            showWelcomePage();
            currentPlayer = null;
            gameState = null;
            currentRoomId = null;
        });
    </script>
</body>
</html>
